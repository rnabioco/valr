---
title: 'Interval statistics in `valr`'
author: "Jay Hesselberth <jay.hesselberth@gmail.com>"
date: '`r Sys.Date()`'
output:
  rmarkdown::html_vignette:
  vignette: >
    %\VignetteIndexEntry{interval-statistics}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r knitr_opts, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "img/interval-statistics-",
  fig.height = 3,
  fig.align = "center",
  fig.width = 4
)
```

# Interval Statistics

`valr` provides several methods to assess statistical properties of interval sets including:
  
- [`bed_fisher()`](#bed_fisher): measure overlap significance of two sets of intervals.
- [`bed_absdist()`](#bed_absdist): quantify *absolute* distance between query intervals and closest reference intervals
- [`bed_reldist()`](#bed_reldist): quantify *relative* distances between query intervals and closest reference intervals
- [`bed_jaccard()`](#bed_jaccard): quantify extent of overlap between two sets of intervals

Several of these methods were described in the [Genometricorr][1] software package.

```{r genome}
library(valr)
genome <- read_genome(valr_example('hg19.chrom.sizes.gz'))
```

## Fisher's test {#bed_fisher}

The Fisher's test assesses whether two sets of intervals are drawn from the same background genome.

```{r fisher}
x <- bed_random(genome)
y <- bed_random(genome)

bed_fisher(x, y, genome)
```

## Absolute distance {#bed_absdist}

`bed_absdist()` computes the absolute distance between the midpoint of query intervals and the closest midpoints of a set of reference intervals. Absolute distances are scaled by the inter-reference gap for the chromosome as follows. For `Q` total query points and `R` reference points on a chromosome, scale the distance for each query point `i` to the closest reference point by the inter-reference gap for each chromosome. 

$$
d_i(x,y) = min_{\substack{k}}(|q_i - r_k|)\frac{R}{Length\ of\ chromsome}
$$

By default both absolute and scaled distances are reported as `absdist` and `scaled_absdist` respectively. 

```{r absdist, eval = TRUE}
x <- bed_random(genome)
y <- bed_random(genome)

bed_absdist(x, y, genome)
```

## Relative distance {#bed_reldist}

`bed_reldist()` computes the relative distance between a query interval and the two closest reference intervals. The relative distance can range between `[0, 0.5]`. If the overall distribution of distances is biased toward zero, then the query and reference intervals tend to be closer in space. By default a summary with the frequency of each relative distance is reported.  

```{r reldist, eval = TRUE}
x <- bed_random(genome)
y <- bed_random(genome)

bed_reldist(x, y)
```

## Jaccard similarity {#bed_jaccard}

`bed_jaccard()` quantifies the extent of overlap between to sets of intervals. The Jaccard statistic takes values of `[0, 1]` and is measured as:

$$
J(x,y) = \frac{\mid x \bigcap y \mid}
{\mid x \bigcup y \mid} 
= 
\frac{\mid x \bigcap y \mid}
{\mid x \mid + \mid y \mid - \mid x \bigcap y \mid}
$$


```{r jaccard}
x <- bed_random(genome)
y <- bed_random(genome)

bed_jaccard(x, y)
```

[1]: http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002529
